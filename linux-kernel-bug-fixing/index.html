<!DOCTYPE html>
<html lang="en">
<head>

    <title>Linux kernel bug fixing</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        :root {
            --button-bg-color: #ffffff;
            --button-text-color: var(--color-darkgrey);
        }
    </style>

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=c25e7298bf.css" />

    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="David hacks" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Linux kernel bug fixing" />
    <meta property="og:description" content="There are various ways to get into Linux kernel development. The aim of getting into Linux kernel development would be either profit or fun or even both. These are the main reasons why people get into Linux kernel development while it would not be surprising to find someone who got" />
    <meta property="og:url" content="gholg.github.iolinux-kernel-bug-fixing/" />
    <meta property="og:image" content="https://static.ghost.org/v4.0.0/images/publication-cover.jpg" />
    <meta property="article:published_time" content="2022-05-18T10:00:40.000Z" />
    <meta property="article:modified_time" content="2022-05-18T10:00:40.000Z" />
    <meta property="article:publisher" content="https://www.facebook.com/ghost" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Linux kernel bug fixing" />
    <meta name="twitter:description" content="There are various ways to get into Linux kernel development. The aim of getting into Linux kernel development would be either profit or fun or even both. These are the main reasons why people get into Linux kernel development while it would not be surprising to find someone who got" />
    <meta name="twitter:url" content="gholg.github.iolinux-kernel-bug-fixing/" />
    <meta name="twitter:image" content="https://static.ghost.org/v4.0.0/images/publication-cover.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="David Kahurani" />
    <meta name="twitter:site" content="@ghost" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "David hacks",
        "url": "gholg.github.io",
        "logo": {
            "@type": "ImageObject",
            "url": "gholg.github.iofavicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "David Kahurani",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/1e577d7f889953da2dc8ab7d94266e83?s=250&d=mm&r=x"
        },
        "url": "gholg.github.ioauthor/david/",
        "sameAs": []
    },
    "headline": "Linux kernel bug fixing",
    "url": "gholg.github.iolinux-kernel-bug-fixing/",
    "datePublished": "2022-05-18T10:00:40.000Z",
    "dateModified": "2022-05-18T10:00:40.000Z",
    "description": "There are various ways to get into Linux kernel development. The aim of getting\ninto Linux kernel development would be either profit or fun or even both. These\nare the main reasons why people get into Linux kernel development while it would\nnot be surprising to find someone who got into Linux kernel development\nprimarily to make a difference in open source. It is a tough road out there so a\ngood reason will keep you motivated all the way. \n\nOne of the ways to get started with Linux kernel develo",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "gholg.github.io"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.45" />
    <link rel="alternate" type="application/rss+xml" title="David hacks" href="../rss/index.html" />
    <script defer src="https://unpkg.com/@tryghost/portal@~1.21.0/umd/portal.min.js" data-ghost="gholg.github.io" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="../public/cards.min.js%3Fv=c25e7298bf"></script><style>:root {--ghost-accent-color: #FF1A75;}</style>
    <link rel="stylesheet" type="text/css" href="../public/cards.min.css%3Fv=c25e7298bf.css">

</head>
<body class="post-template">
<div class="viewport">

    <header id="gh-head" class="gh-head has-cover">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../index.html">
                        David hacks
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-about"><a href="../about/index.html">About</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                        <a class="gh-social-facebook" href="https://www.facebook.com/ghost" title="Facebook" target="_blank" rel="noopener"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 0c8.837 0 16 7.163 16 16s-7.163 16-16 16S0 24.837 0 16 7.163 0 16 0zm5.204 4.911h-3.546c-2.103 0-4.443.885-4.443 3.934.01 1.062 0 2.08 0 3.225h-2.433v3.872h2.509v11.147h4.61v-11.22h3.042l.275-3.81h-3.397s.007-1.695 0-2.187c0-1.205 1.253-1.136 1.329-1.136h2.054V4.911z" /></svg></a>
                        <a class="gh-social-twitter" href="https://twitter.com/ghost" title="Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
                </div>

                    <a class="gh-head-button" href="index.html#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
    <article class="article post no-image ">

        <header class="article-header gh-canvas">


            <h1 class="article-title">Linux kernel bug fixing</h1>


            <div class="article-byline">
                <section class="article-byline-content">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <a href="../author/david/index.html" class="author-avatar">
                                <img class="author-profile-image" src="http://www.gravatar.com/avatar/1e577d7f889953da2dc8ab7d94266e83?s=250&amp;d=mm&amp;r=x" alt="David Kahurani" />
                            </a>
                        </li>
                    </ul>
                    <div class="article-byline-meta">
                        <h4 class="author-name"><a href="../author/david/index.html">David Kahurani</a></h4>
                        <div class="byline-meta-content">
                            <time class="byline-meta-date" datetime="2022-05-18">May 18, 2022</time>
                            <span class="byline-reading-time"><span class="bull">&bull;</span> 4 min read</span>
                        </div>
                    </div>
                </section>
            </div>

        </header>

        <section class="gh-content gh-canvas">
            <p>There are various ways to get into Linux kernel development. The aim of getting into Linux kernel development would be either profit or fun or even both. These are the main reasons why people get into Linux kernel development while it would not be surprising to find someone who got into Linux kernel development primarily to make a difference in open source. It is a tough road out there so a good reason will keep you motivated all the way. </p><p>One of the ways to get started with Linux kernel development is to fix bugs and regressions in the kernel. You could start with fixing easy bugs and progress to harder ones as you gain skill and experience. Hacking on the Linux kernel(which contains some of the best written open source code) could also help a lot in improving your C programming/development skills. There are two places where one can find bugs that they could possibly fix in the Linux kernel. These places are <a href="https://syzkaller.appspot.com/upstream">syzkaller</a> and <a href="https://lore.kernel.org/regressions/">regressions mailing list.</a> </p><p>syzkaller is a fuzzing bot developed by the fuzzing team at Google. There are numerous other tools developed by the same team at Google. Some of these are in-kernel instrumentation like KMSAN, KCSAN, and KASAN. All the three tools assist with finding memory corruption bugs in the kernel but KMSAN and KCSAN have yet to be merged into the Linux kernel. It is also considered to be a bug when warnings and other instrumentation built into the kernel like the BUG are hit when fuzzing. KMSAN, KCSAN, and KASAN allow for syzkaller to detect bugs such as use-after-free, use of uninitialized variables in code, out-of-bounds access, and race conditions. Another tool that syzkaller relies on is kmemleak which allows for detecting memory leaks.</p><p>On the other hand, the regressions list contains issues that have been reported to be affecting recent kernels but were not affecting older kernels or, in other words, bugs that were introduced. These are also sometimes easy to fix as you can bisect and pick the offending commit and then analyze the change and how it introduced the said regression. For both cases, patches developed should be sent over to the relevant mailing list for review and possible merging into the mainline Linux kernel.</p><p>To debug the Linux kernel, one can take the approach of reproducing the bugs or diving very deep into the related code to figure out the issue from a code perspective. Both reproducing the bug and diving into related code can be very hard. For reproducing you have to get a kernel, compile it with the appropriate <em>.config, </em>load it onto a virtual machine which you connect to via a debugger, run the reproducer and finally use the debugger to break and step into relevant code. This can be a very painstaking setup especially when it has to be done for each and every bug differently. For a virtual machine and debugger, one can use the Qemu-kvm and gdb which works pretty well for kernel debugging.</p><p>The other approach would be to interpret the stacktrace(which to some extent is already interpreted in the syzkaller bug reports) and read the code related to the functions in the stacktrace using a text editor(like vim, which works very well). Use GNU grep to follow functions through the code and establish points at which they are called. In most stacktraces, the code is being called as a result of an interrupt, either software or hardware. This approach is not easy either as you might find yourself opening more than 10 terminal windows and trying to make sense of the code.</p><p>Once one establishes what the cause of the issue is, the next step would be identifying the root cause and fixing the bug from there. This is especially very difficult even for presumably easy bugs like uninit-value. A more serious underlying issue will usually be the cause of the unexpectedly uninitialized variable. To demonstrate that this is fairly hard, I will use an example of a bug I tried to fix. I did, yes, manage to silence the fuzzing tools but the patch I developed did not look like something I could send to the Linux kernel mailing list.</p><p>To demonstrate the above, we are going to inspect and try to fix one bug. The bug is <a href="https://syzkaller.appspot.com/bug?id=fb453bc21cf8eb5cd3ba91406b5d22e8915cf299">uninit -value in sctp_inq_pop</a>. From the stacktrace it can be seen that some variable in </p><!--kg-card-begin: html--><script src="https://gist.github.com/GholG/336dd883474d186f4b2afa3394a3718c.js"></script><!--kg-card-end: html--><p>is uninitialized.</p><p>The value chunk_end is stored here and later used a few lines further into the function in the code:</p><!--kg-card-begin: html--><script src="https://gist.github.com/GholG/3344fc504603e119122fc6914def10f3.js"></script><!--kg-card-end: html--><p>which triggers the uninit-value error.</p><p>First, it is not clear which variable exactly is uninitialized but given the two code snippets, we can safely speculate that chunk_end is uninitialized, or rather, it has been initialized from a value that was not initialized. From looking at this function further, we can tell that ch(struct sctp_chunkhdr *) is the first segment of the memory stored in data which is a member of an skb which we can tell from the stacktrace was created at:</p><!--kg-card-begin: html--><script src="https://gist.github.com/GholG/7e4ebd05696c06f4cfe898018707366b.js"></script><!--kg-card-end: html--><p>Data(the contents of another skb) are then copied onto the newly created skb further down the same function:</p><!--kg-card-begin: html--><script src="https://gist.github.com/GholG/59c0493bbb3348ca57510cb3c7cd6b28.js"></script><!--kg-card-end: html--><p> This would mean that the data being copied is uninitialized and this is the source of our issue. It means an skb was created but it's header section was never initialized. This, however leads us to a dead-end because by using grep we can identify four sections of code within the sctp code that call 'alloc_skb'. </p><figure class="kg-card kg-image-card"><img src="../content/images/2022/05/Screenshot-from-2022-05-18-12-36-13.png" class="kg-image" alt loading="lazy" width="811" height="122" srcset="../content/images/size/w600/2022/05/Screenshot-from-2022-05-18-12-36-13.png 600w, ../content/images/2022/05/Screenshot-from-2022-05-18-12-36-13.png 811w" sizes="(min-width: 720px) 720px"></figure><p>Our analysis hits a dead end though since none of these 'alloc_skb' calls seem relevant to our bug. </p><p>However, it was still possible for us to confirm that the issue lies within 'ch-&gt;length' not being set by running this patch:</p><!--kg-card-begin: html--><script src="https://gist.github.com/GholG/7f86f8b0e5989fa830efc3e16c835adc.js"></script><!--kg-card-end: html--><p>through syzbot which managed to get the error to go away.</p><p>All in all, we did not get to the root cause of the bug since it looks like this uninitialized skb is created by some other Linux code other than sctp code. This however demonstrates that even seemingly simple uninit-value bugs could be very deeply embedded into the code and difficult to fix.</p>
        </section>


    </article>
</main>


    <section class="footer-cta ">
        <div class="inner">
            <h2>Sign up for more like this.</h2>
            <a class="footer-cta-button" href="index.html#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>




            <aside class="read-more-wrap">
                <div class="read-more inner">
                        
<article class="post-card post no-image ">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../qemu-amd-vi/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Qemu AMD-Vi</h2>
            </header>
            <div class="post-card-excerpt">
                <p>After tonnes of blood, tears, and sweat...  I'm glad to have been working on Qemu AMD IOMMU emulation as part of GSoC and to have achieved most of what was planned, that is, both a working host translation implementation and a working interrupt remapping implementation. The code implementing this device</p>
            </div>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/david/index.html" class="static-avatar">
                        <img class="author-profile-image" src="http://www.gravatar.com/avatar/1e577d7f889953da2dc8ab7d94266e83?s=250&amp;d=mm&amp;r=x" alt="David Kahurani" loading="lazy" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span class="post-card-byline-author"><a href="../author/david/index.html">David Kahurani</a></span>
                <span class="post-card-byline-date"><time datetime="2022-05-13">May 13, 2022</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>
                        
<article class="post-card post ">

    <a class="post-card-image-link" href="../coming-soon/index.html">
        <img class="post-card-image"
            srcset="https://static.ghost.org/v4.0.0/images/feature-image.jpg 300w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 600w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 1000w,
                    https://static.ghost.org/v4.0.0/images/feature-image.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="https://static.ghost.org/v4.0.0/images/feature-image.jpg"
            alt="Hello"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../coming-soon/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Hello</h2>
            </header>
            <div class="post-card-excerpt">
                <p>My name is David, a software developer primarily involved with open source. I started programming and developing software in the year 2012 soon after leaving high where I left a record of being a very outstanding student. With the free time in my hands before joining college, I started learning</p>
            </div>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/david/index.html" class="static-avatar">
                        <img class="author-profile-image" src="http://www.gravatar.com/avatar/1e577d7f889953da2dc8ab7d94266e83?s=250&amp;d=mm&amp;r=x" alt="David Kahurani" loading="lazy" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span class="post-card-byline-author"><a href="../author/david/index.html">David Kahurani</a></span>
                <span class="post-card-byline-date"><time datetime="2022-04-24">Apr 24, 2022</time> <span class="bull">&bull;</span> 1 min read</span>
            </div>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../index.html">David hacks</a> &copy; 2022</section>
            <nav class="site-footer-nav">
                <ul class="nav">
    <li class="nav-sign-up"><a href="index.html#/portal/">Sign up</a></li>
</ul>

            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../assets/built/casper.js%3Fv=c25e7298bf"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>



</body>
</html>
